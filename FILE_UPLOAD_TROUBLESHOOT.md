# 文件上传问题解决方案

## 问题描述
- 前端访问地址：`http://192.168.56.1:5173`（非localhost）
- 后端无法连接，返回422错误

## 根本原因
当使用非localhost地址访问前端时，Vite的代理配置无效，导致前端直接跨域请求后端，被CORS阻止。

## 解决方案

### 步骤1：重启前端开发服务器
必须重启Vite开发服务器以加载新的配置：

```bash
# 1. 终止当前运行的Vite服务器（Ctrl+C）
# 2. 重新运行
cd frontend
npm run dev
```

### 步骤2：确保后端正确运行
后端必须在 `localhost:5000` 上运行：

```bash
cd backend
python app.py
```

### 步骤3：测试连接
在浏览器中打开后端健康检查端点：
```
http://192.168.56.1:5000/api/health
```

如果看到：
```json
{"code": 200, "message": "OK", "status": "healthy"}
```

说明后端正常运行。

### 步骤4：返回前端并测试
访问：`http://192.168.56.1:5173`

现在应该能正常上传文件了。

## 工作原理

### 开发环境（访问 /api）
```
前端请求 → Vite代理 → 后端 (localhost:5000)
```

### 非本地访问（访问 192.168.56.1:5173）
```
前端请求 → 自动拼接完整URL → 后端 (192.168.56.1:5000)
```

前端API配置会自动检测环境并选择合适的连接方式。

## 常见问题

### 问题1：仍然显示422错误
- 确认已重启Vite dev server
- 检查后端是否真的在运行
- 查看浏览器开发者工具的Network标签，看请求是否到达后端

### 问题2：CORS错误
- 确保后端已启用CORS（已在代码中配置）
- 检查后端是否正确处理OPTIONS请求

### 问题3：连接超时
- 确认后端在 `localhost:5000` 运行（不要用其他IP）
- 检查防火墙是否阻止了5000端口
- 运行 `check-status.bat` 检查端口占用

## 重新启动步骤

```bash
# 终端1 - 启动后端
cd backend
python app.py

# 终端2 - 启动前端（需要重新运行！）
cd frontend
npm run dev

# 然后在浏览器打开
# http://localhost:5173 （localhost方式会使用Vite代理）
# 或
# http://192.168.56.1:5173 （会直接连接到后端5000端口）
```

## 验证清单

- [ ] 后端运行在 `localhost:5000`
- [ ] 前端运行在 `localhost:5173` 或 `192.168.56.1:5173`
- [ ] 后端健康检查返回200
- [ ] 前端已重新启动（npm run dev）
- [ ] 浏览器已刷新（F5或Ctrl+R）
